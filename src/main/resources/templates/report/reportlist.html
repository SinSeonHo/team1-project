<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}">
  <head>
    <meta charset="UTF-8" />
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>

    <!-- CSRF ë©”íƒ€íƒœê·¸ -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <!-- JS ì™¸ë¶€ íŒŒì¼ -->
    <script th:src="@{/js/admin.js}"></script>

    <!-- ì‹ ê³  ë¦¬ìŠ¤íŠ¸ ì „ìš© ìµœì†Œ ìŠ¤íƒ€ì¼ -->
    <style>
      table.report-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      table.report-table th,
      table.report-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      td,
      label {
        color: #ffffff;
      }
      table.report-table th {
        background-color: #f4f4f4;
      }
      .status-pending {
        color: orange;
        font-weight: bold;
      }
      .status-done {
        color: green;
        font-weight: bold;
      }
      .status-rejected {
        color: red;
        font-weight: bold;
      }
      .btn {
        padding: 6px 10px;
        border: none;
        background: #007bff;
        color: white;
        border-radius: 4px;
        text-decoration: none;
        cursor: pointer;
      }
      .btn:hover {
        background: #0056b3;
      }
      .search-form {
        margin-top: 20px;
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body layout:fragment="content">
    <h1 class="text-center">ê´€ë¦¬ì ì‹ ê³  ë¦¬ìŠ¤íŠ¸</h1>

    <!-- ğŸ” ê²€ìƒ‰ & í•„í„° -->
    <form method="get" th:action="@{/admin/report/list}" class="search-form text-center">
      <label>
        ê²€ìƒ‰:
        <input type="text" name="keyword" placeholder="ì•„ì´ë””/ë‹‰ë„¤ì„/ì‚¬ìœ " th:value="${keyword}" />
      </label>
      <label>
        ìƒíƒœ:
        <select name="status">
          <option value="" th:selected="${selectedStatus == null or selectedStatus == ''}">ì „ì²´</option>
          <option value="PENDING" th:selected="${selectedStatus == 'PENDING'}">ëŒ€ê¸°</option>
          <option value="IN_PROGRESS" th:selected="${selectedStatus == 'IN_PROGRESS'}">ê²€í† ì¤‘</option>
          <option value="DONE" th:selected="${selectedStatus == 'DONE'}">ì²˜ë¦¬ì™„ë£Œ</option>
          <option value="REJECTED" th:selected="${selectedStatus == 'REJECTED'}">ê±°ì ˆ</option>
        </select>
      </label>
      <button type="submit" class="btn">ê²€ìƒ‰</button>
    </form>

    <!-- ğŸ“‹ ì‹ ê³  ë¦¬ìŠ¤íŠ¸ -->
    <table class="report-table">
      <thead>
        <tr>
          <th>ë²ˆí˜¸</th>
          <th>ì‹ ê³ ì ID</th>
          <th>ì‹ ê³ ì ë‹‰ë„¤ì„</th>
          <th>ëŒ€ìƒ ID</th>
          <th>ëŒ€ìƒ ë‹‰ë„¤ì„</th>
          <th>ì¹´í…Œê³ ë¦¬</th>
          <th>ì‹ ê³  ì‚¬ìœ </th>
          <th>ìƒì„¸ ì„¤ëª…</th>
          <th>ê²Œì‹œê¸€</th>
          <th>ì¦ê±° ìë£Œ</th>
          <th>ì‹ ê³  ì¼ì‹œ</th>
          <th>ì²˜ë¦¬ ìƒíƒœ</th>
          <th>ì²˜ë¦¬ì</th>
          <th>ì²˜ë¦¬ì¼</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="report, iterStat : ${reports}">
          <td th:text="${iterStat.index + 1}">1</td>
          <td th:text="${report.reporter.id}">user01</td>
          <td th:text="${report.reporter.nickname}">í™ê¸¸ë™</td>
          <td th:text="${report.reply.replyer.id}">target99</td>
          <td th:text="${report.reply.replyer.nickname}">ì„êº½ì •</td>
          <td th:text="${report.reason}">ìš•ì„¤</td>
          <td th:text="${report.detail != null ? report.detail : '-'}">ì‹¬í•œ ìš•ì„¤ ì‚¬ìš©</td>
          <td>
            <a th:href="@{/posts/{postId}(postId=${report.reply.rno})}" target="_blank">ë³´ê¸°</a>
          </td>
          <td>
            <span th:if="${report.evidenceUrl != null}">
              <a th:href="${report.evidenceUrl}" target="_blank">ë³´ê¸°</a>
            </span>
            <span th:if="${report.evidenceUrl == null}">ì—†ìŒ</span>
          </td>
          <td th:text="${#dates.format(report.reportDate, 'yyyy-MM-dd HH:mm')}">2025-08-12 14:30</td>
          <td
            th:text="${report.status}"
            th:classappend="
                ${report.status == 'PENDING'} ? 'status-pending' :
                ${report.status == 'DONE'} ? 'status-done' :
                ${report.status == 'REJECTED'} ? 'status-rejected' : ''"
          >
            ëŒ€ê¸°
          </td>
          <td th:text="${report.handlerName != null ? report.handlerName : '-'}">-</td>
          <td th:text="${report.handleDate != null ? #dates.format(report.handleDate, 'yyyy-MM-dd HH:mm') : '-'}">-</td>
        </tr>
        <tr th:if="${#lists.isEmpty(reports)}">
          <td colspan="14" style="color: #fff">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
      </tbody>
    </table>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ ì œê±° (Listë¼ì„œ ì§€ì› ì•ˆí•¨) -->
  </body>
</html>
