<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layout}">
  <th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/userProfile.css}">
  </th:block>

  <main layout:fragment="content">
    <div class="container py-5" style="max-width: 800px">
      <div class="row justify-content-center align-items-stretch">
        <h2 class="mb-5 text-center fw-bold" style="color: #fff; letter-spacing: 2px">프로필 정보 설정</h2>
        <form th:action="@{/user/modifyUserProfile}" th:object="${userProfileDTO}" method="post" enctype="multipart/form-data">
          <div class="row justify-content-center">
            <!-- 프로필 사진 & 버튼 그룹 -->
            <div class="col-md-4 d-flex flex-column align-items-center mb-4 mb-md-0 gap-2">
              <div class="mb-3 position-relative">
                <img th:src="@{${userProfileDTO.profileImageUrl} ?: '/images/sample.jpg'}"
                     alt="프로필" class="rounded-circle shadow"
                     style="width: 200px; height: 200px; object-fit: cover; border: 3px solid #277aff; background: #eee" />
              </div>
              <!-- 사진 변경 버튼 -->
               <div class="d-flex flex-column w-100 px-4" style="gap: 8px">
              
              <button type="button" class="profile-btn profile-btn-danger">
                <a th:href="@{/user/delete(id=${userProfileDTO.id})}">회원탈퇴</a></button>
              </div>
              <!-- 회원탈퇴 버튼 -->
            </div>
            <!-- 정보 입력 폼 -->
            <div class="col-md-8">
              <div class="user-info-list mb-4">
                <div class="user-info-item">
                  <label for="name" class="user-info-label">이름</label>
                  
                  <span id="text" name="name" class="form-control user-info-value">[[*{name}]]</span>
                </div>
                <div class="user-info-item">
                  <label for="nickname" class="user-info-label">닉네임</label>
                  <input type="text" class="form-control user-info-value"
                         id="nickname" name="nickname" th:value="*{nickname} ?: ''" maxlength="20" autocomplete="off" th:field="*{nickname}"/>
                         <div th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}" class="text-danger"></div>
                </div>
                <div class="user-info-item">
                  <label for="userid" class="user-info-label">아이디</label>
                  <input type="text" class="form-control user-info-value"
                         id="userid" name="id" th:value="*{id}" readonly />
                </div>
                <div class="user-info-item" th:if="*{email} != null">
                  <label for="email" class="user-info-label">이메일</label>
                  <span id="email" name="email" class="form-control user-info-value">[[*{email} ?: '인증 필요']]</span>
                </div>
                <!-- 소셜 인증 버튼(이메일 없을 때만) -->
                <div class="user-info-item" th:if="*{email} == null">
                  <div class="mb-2" style="font-weight: 500; color: #fff;">이메일 인증</div>
                  <div class="d-flex flex-row gap-3 mb-2 justify-content-start">
                    <a href="/oauth2/authorization/google"
                       class="d-flex align-items-center justify-content-center shadow"
                       style="width:48px; height:48px; border-radius:16px; background:#fff;">
                      <img th:src="@{/social/googleSquare.png}" alt="구글" style="width:28px; height:28px;" />
                    </a>
                    <a href="/oauth2/authorization/kakao"
                       class="d-flex align-items-center justify-content-center shadow"
                       style="width:48px; height:48px; border-radius:16px; background:#FAE100;">
                      <img th:src="@{/social/kakaoSquareReal.png}" alt="카카오" style="width:28px; height:28px;" />
                    </a>
                    <a href="/oauth2/authorization/naver"
                       class="d-flex align-items-center justify-content-center shadow"
                       style="width:48px; height:48px; border-radius:16px; background:#03C75A;">
                      <img th:src="@{/social/naverSquare.png}" alt="네이버" style="width:28px; height:28px;" />
                    </a>
                  </div>
                  <p class="text-white small ml-3">
                    원하는 계정 아이콘을 눌러 이메일 인증을 진행하세요.
                  </p>
                </div>
                <div class="user-info-item">
                  <label for="grade" class="user-info-label">마일리지 등급</label>
                  <input type="text" class="form-control user-info-value"
                         id="grade" name="grade" th:value="*{grade} ?: ''" maxlength="10" readonly />
                </div>
              </div>
              <div class="d-flex gap-2">
                <button type="submit" class="profile-btn profile-btn-secondary">저장</button>
                <a th:href="@{/user/userProfile(id=${userProfileDTO.id})}"  class="profile-btn profile-btn-lightgray" style="text-align:center;">취소</a>
              </div>
            </div>
          </div>

          <!-- 갤러리 (수정 페이지에서도 보여줄 수 있음) -->
        </form>
      </div>
    </div>
  </main>
  <th:block layout:fragment="script">
    <script th:src="@{/js/userProfile.js}"></script>
  </th:block>
</html>
