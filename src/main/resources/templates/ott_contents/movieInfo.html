<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layout}">
  <body>
    <div layout:fragment="content">
      <!-- ìì‹ í…œí”Œë¦¿ ì „ìš© ìŠ¤íƒ€ì¼ (head ë°–, content ë‚´ë¶€ ìµœìƒë‹¨ì— ë‘ ) -->
      <style>
        /* ê°•ì œ ë®ì–´ì“°ê¸° */
        .anime__details__widget ul li span {
          width: auto !important;
          display: inline !important;
          color: inherit !important;
        }
        .anime__details__widget li {
          list-style: none;
          font-size: 16px;
          line-height: 32px;
          color: #ffffff;
          font-weight: 400;
        }

        .anime__details__widget li span:first-child {
          color: #b7b7b7; /* ë¼ë²¨(ì™¼ìª½) ìƒ‰ìƒ */
          font-weight: 600;
          margin-right: 10px;
          display: inline-block;
          min-width: 100px; /* ë¼ë²¨ ê¸¸ì´ í†µì¼ */
        }

        .anime__details__widget li span:last-child {
          color: #ffffff; /* ê°’(ì˜¤ë¥¸ìª½) ìƒ‰ìƒ */
          font-weight: 400;
        }
      </style>

      <div class="gradient-bg">
        <!-- ì˜í™”ìƒì„¸í˜ì´ì§€ -->
        <div class="breadcrumb-option">
          <div class="container">
            <div class="col-lg-12">
              <a th:href="@{/}">Home</a>
              <a href="#">></a>
              <a th:href="@{/api/movies/list}">MovieList</a>
              <a href="#">></a>
              <a href="#">MovieInfo</a>
            </div>
          </div>
        </div>

        <!-- ìƒì„¸ì •ë³´ -->
        <section class="anime-details spad">
          <div class="container">
            <div class="anime__details__content">
              <div class="row">
                <div class="col-lg-3">
                  <img
                    th:src="@{${movieInfo.image != null} ? '/images/movieimages/' + ${movieInfo.image.imgName} : '/images/sample.jpg'}"
                    onerror="this.onerror=null; this.src='/images/sample.jpg';"
                    alt="ì˜í™” ì´ë¯¸ì§€"
                    loading="lazy"
                    class="anime__details__pic"
                  />
                </div>
                <div class="col-lg-9">
                  <div class="anime__details__text">
                    <div class="anime__details__title">
                      <h3 th:text="${movieInfo.title}"></h3>
                      <span th:text="'ê°ë… : ' + ${movieInfo.director}"></span>
                      <span th:text="'ë°°ìš° : ' + ${movieInfo.actors}"></span>
                      <br />
                      <h4 text="ì‹œë†‰ì‹œìŠ¤" class="synopsis_t"></h4>
                      <span th:text="${movieInfo.synopsis}" class="synopsis"></span>
                    </div>

                    <div class="anime__details__widget">
                      <div class="row">
                        <div class="col-lg-6 col-md-6">
                          <ul>
                            <li><span>ê°œë´‰ì¼</span> <span th:text="${movieInfo.openDate}"></span></li>
                            <li><span>ì¥ë¥´</span><span th:text="${movieInfo.genres}"></span></li>
                            <li><span>ìƒì˜ì‹œê°„</span><span th:text="${movieInfo.showTm}"></span></li>
                            <li><span>ì ì •ê´€ëŒë“±ê¸‰</span><span th:text="${movieInfo.gradeNm}"></span></li>
                            <li><span>ê°œë´‰êµ­ê°€</span><span th:text="${movieInfo.nationNm}"></span></li>
                          </ul>
                        </div>
                      </div>
                    </div>

                    <div class="anime__details__btn" th:if="${#authentication.name !='anonymousUser'}">
                      <button
                        class="follow-btn"
                        th:classappend="${isFollowed} ? ' follow' : ''"
                        th:data-mid="${movieInfo.mid}"
                        th:text="${isFollowed} ? 'Followed' : 'Follow'"
                      ></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ìŠ¤í¬ë¦°ìƒ· ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ -->
            <div class="slider-container" id="sliderContainer">
              <div class="slider" id="slider">
                <img
                  th:each="url : ${screenshotUrls}"
                  th:src="${url}"
                  alt="ìŠ¤í¬ë¦°ìƒ· ì´ë¯¸ì§€"
                  style="border-radius: 10px"
                />
              </div>
            </div>

            <!-- ëª¨ë‹¬ì°½ -->
            <div id="modal" class="modal" style="display: none">
              <span id="modalClose" class="modal-close">&times;</span>
              <button id="prevBtn" class="nav-btn prev-btn">&#10094;</button>
              <img id="modalImg" src="" alt="í™•ëŒ€ ì´ë¯¸ì§€" />
              <button id="nextBtn" class="nav-btn next-btn">&#10095;</button>
            </div>

            <div class="center-line"></div>
          </div>
          <!-- .container -->
        </section>

        <!-- ëŒ“ê¸€ ì˜ì—­ -->
        <div class="col-lg-6 mx-auto">
          <div class="anime__details__review">
            <div class="section-title">
              <h5 id="replyCnt" th:text="'ëŒ“ê¸€ '+${replies.size} + ê°œ"></h5>
            </div>
            <!-- ë³„ì  -->
            <div class="rating mb-3">
              <span th:text="' í‰ê·  '+${rating}+'ì '">í‰ê·  ë³„ì </span>
            </div>
            <!-- ëŒ“ê¸€ ì‹œì‘ -->
            <div th:each="reply : ${replies}">
              <div class="anime__review__item">
                <div class="re-reply-tag" th:if="${reply.ref != null}"></div>
                <div class="anime__review__item__pic">
                  <!-- ë¡œê·¸ì¸: í”„ë¡œí•„ ì´ë¯¸ì§€ / ì—†ì„ ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ -->
                  <img
                    th:src="${reply.thumbnailPath == null} ? '/images/sample.jpg' : '/images/view/' + ${reply.thumbnailPath}"
                    alt="í”„ë¡œí•„"
                    class="rounded-circle border border-primary shadow-sm"
                    style="width: 40px; height: 40px; object-fit: cover; background: #eee"
                  />
                </div>
                <div
                  class="anime__review__item__text reply"
                  th:data-rno="${reply.rno}"
                  th:data-replyer="${reply.replyer}"
                  th:data-replyerNickname="${reply.replyerNickname}"
                  th:data-text="${reply.text}"
                  th:data-mid="${reply.id}"
                  th:data-mention="${reply.mention}"
                  th:data-ref="${reply.ref}"
                  th:data-rate="${reply.rate}"
                >
                  <span class="replyer text-light" th:text="${reply.replyerNickname}"></span>
                  <span class="text-secondary" th:text="' - ' + ${reply.updatedDate}">ì‘ì„±ì - 1 Hour ago</span>
                  <button
                    type="button"
                    class="delete-btn btn btn-secondary btn-sm"
                    th:if="${#authentication.name == reply.replyer}"
                    th:data-rno="${reply.rno}"
                  >
                    âœ–
                  </button>
                  <button
                    type="button"
                    class="update-btn btn btn-secondary btn-sm"
                    th:if="${#authentication.name == reply.replyer}"
                    th:data-rno="${reply.rno}"
                  >
                    ìˆ˜ì •
                  </button>
                  <button
                    type="button"
                    class="mention-btn btn btn-secondary btn-sm"
                    th:if="${#authentication.name != 'anonymousUser'}"
                    th:data-rno="${reply.rno}"
                  >
                    ëŒ“ê¸€
                  </button> 
                  <button class="report-btn btn btn-secondary btn-sm"
                    th:if="${#authentication.name != 'anonymousUser'}"
                    th:data-rno="${reply.rno}">ğŸš¨</button>
                  <!-- ë¦¬ë·°ëŠ” ë³„ì  í‘œì‹œ -->
                  <span>
                    <i
                      th:if="${reply.ref == null}"
                      th:each="idx : ${#numbers.sequence(0, 4)}"
                      class="fa-star"
                      th:classappend="${reply.rate > idx ? 'fa':'fa-regular'}"
                    ></i>
                  </span>
                  <pre><p th:text="${reply.text}">ëŒ“ê¸€ í…ìŠ¤íŠ¸</p></pre>
                </div>
              </div>
          </div>

          <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
          <div class="anime__details__form" th:fragment="replyform">
            <div class="section-title">
              <h5>ëŒ“ê¸€ ì‘ì„±</h5>
            </div>
            <span class="mention badge badge-secondary btn p-2"></span>
            <form id="replyForm" method="post" th:if="${#authentication.name != 'anonymousUser'}">
              <input type="hidden" name="id" th:value="${movieInfo.mid}" />
              <input type="hidden" name="rno" />
              <input type="hidden" name="replyer" th:value="${#authentication.name}" />
              <input type="hidden" name="mention" />
              <input type="hidden" name="ref" />
              <!-- ë³„ì  -->
              <div class="rating-form">
                <input type="hidden" name="rate" />
                <span class="rating" name="rate"
                  >í‰ê°€:
                  <i th:each="idx : ${#numbers.sequence(1, 5)}" class="fa-regular fa-star" th:data-value="${idx}"></i>
                </span>
              </div>
              <textarea name="text" id="replytext" placeholder="Your Comment"></textarea>
              <div class="mb-4"><span id="currentCharCount">0</span> / <span id="maxChar">200</span>ê¸€ì</div>
              <button class="btn btn-insert modalBtn" type="submit" style="font-size: medium">ë“±ë¡</button>
              <button class="btn btn-cancel" type="button" style="font-size: medium">ì·¨ì†Œ</button>
            </form>

            <div th:if="${#authentication.name == 'anonymousUser'}">
              <a href="/user/login" class="btn site-btn" style="color: #eee">ë¡œê·¸ì¸</a>
            </div>
            <div class="p-4"></div>
          </div>
          <!-- ëŒ“ê¸€ ì‘ì„± í¼ ë -->
        </div>
        <!-- col-lg-6 mx-auto -->

        <!-- ìŠ¤í¬ë¦½íŠ¸ -->
        <script th:src="@{/js/reply.js}"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
          const id = "[[${movieInfo.mid}]]";
          const csrf = "[[${_csrf.token}]]";
        </script>
        <script th:src="@{/js/followbtn.js}"></script>
        <script th:src="@{/js/imgSlider.js}"></script>
        <script th:src="@{/js/imgModal.js}"></script>
      </div>
      <!-- gradient-bg -->
    </div>
    <!-- layout:fragment -->
  </body>
</html>
