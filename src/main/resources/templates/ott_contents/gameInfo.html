<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layout}">
      <th:block layout:fragment="metadata">
        <meta name="current-user-id"
      th:content="${#authorization.expression('isAuthenticated()') ? #authentication.principal.securityUserDTO.id : ''}" />

     </th:block>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <th:block layout:fragment="@{/report.css}"></th:block>
    <title>GameInfo</title>
      <th:block layout:fragment="css">
  <link rel="stylesheet" th:href="@{/css/report.css}">
  </th:block>
    <style>
      /* Í∞ïÏ†ú ÎçÆÏñ¥Ïì∞Í∏∞ */
      .anime__details__widget ul li span {
        width: auto !important;
        display: inline !important;
        color: #ffffff;
      }
    </style>
  </head>
  
  <body>
    <div layout:fragment="content">
      <div class="gradient-bg">
        <!-- Í≤åÏûÑÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ -->
        <div class="breadcrumb-option">
          <div class="container">
            <div class="col-lg-12">
              <a th:href="@{/}">Home</a>
              <a href="#">></a>
              <a th:href="@{/api/games/list}">GameList</a>
              <a href="#">></a>
              <a href="#">GameInfo</a>
            </div>
          </div>
        </div>
        <!-- Anime Section Begin -->

        <section class="anime-details spad">
          <div class="container">
            <div class="anime__details__content">
              <div class="row">
                <div class="col-lg-5">
                  <img
                    th:src="@{${gameInfo.image != null} ? '/images/gameimages/' + ${gameInfo.image.imgName} : '/images/sample.jpg'}"
                    onerror="this.onerror=null; this.src='/images/sample.jpg';"
                    alt="Í≤åÏûÑ Ïù¥ÎØ∏ÏßÄ"
                    loading="lazy"
                    class="anime__details__pic"
                  />
                </div>
                <div class="col-lg-7" id="gameInfo">
                  <div class="anime__details__text">
                    <div class="anime__details__title">
                      <h3 th:text="${gameInfo.title}"></h3>
                      <!-- <h4 th:text="ÏãúÎÜâÏãúÏä§" class="synopsis_t"></h4>
                      <span th:text="${gameInfo.synopsis}" class="synopsis"></span> -->
                    </div>

                    <div class="anime__details__widget">
                      <div class="row">
                        <!-- ÏôºÏ™Ω Ïó¥: ÏÉÅÏúÑ 5Í∞ú Ï†ïÎ≥¥ -->
                        <div class="col-lg-6 col-md-6">
                          <ul class="list-unstyled">
                            <li><span>ÎèôÏãúÏ†ëÏÜçÏûê</span> <span th:text="${gameInfo.ccu} + 'Î™Ö'"></span></li>
                            <li><span>Ïû•Î•¥</span><span th:text="${gameInfo.genres}"></span></li>
                            <li>
                              <span>Í∞ÄÍ≤©</span>
                              <span>
                                <span
                                  style="color: gray; text-decoration: line-through; margin-right: 8px"
                                  th:if="${gameInfo.discountRate != 0}"
                                  th:text="|${gameInfo.originalPrice}|"
                                ></span>
                                <!-- Í∞ÄÍ≤© Ï°¥Ïû¨Ïó¨Î∂ÄÏóêÎî∞Îùº Î¨¥Î£å or Ìï†Ïù∏Ï§ë or ÏùºÎ∞òÍ∏àÏï° Î≥¥Ïó¨Ï£ºÍ∏∞ -->
                                <!-- Î¨¥Î£åÏù∏ Í≤ΩÏö∞ -->
                                <span th:if="${gameInfo.price == 'Î¨¥Î£åÌîåÎ†àÏù¥'}" style="font-weight: bold">
                                  Free To Play
                                </span>
                                <!-- Ìï†Ïù∏ Ï§ëÏù∏ Í≤ΩÏö∞ -->
                                <span
                                  th:if="${gameInfo.discountRate > 0}"
                                  style="font-weight: bold"
                                  th:text="|${gameInfo.price} (-${gameInfo.discountRate}%)|"
                                >
                                </span>

                                <!-- Ìï†Ïù∏ ÏóÜÏùå + Î¨¥Î£åÎèÑ ÏïÑÎãò -->
                                <span
                                  th:if="${gameInfo.discountRate == 0 and gameInfo.price != 'Î¨¥Î£åÌîåÎ†àÏù¥'}"
                                  style="font-weight: bold"
                                  th:text="${gameInfo.price}"
                                >
                                </span>
                              </span>
                            </li>
                            <li><span>Ï¢ãÏïÑÏöî Ïàò</span><span th:text="${gameInfo.positive} + 'Í∞ú'"></span></li>
                            <li><span>Ïã´Ïñ¥Ïöî Ïàò</span><span th:text="${gameInfo.negative} + 'Í∞ú'"></span></li>
                          </ul>
                        </div>

                        <!-- Ïò§Î•∏Ï™Ω Ïó¥: ÌïòÏúÑ 5Í∞ú Ï†ïÎ≥¥ -->
                        <div class="col-lg-6 col-md-6">
                          <ul class="list-unstyled">
                            <li><span>Í∞úÎ∞úÏÇ¨</span><span th:text="${gameInfo.developer}"></span></li>
                            <li><span>Î∞∞Í∏âÏÇ¨</span><span th:text="${gameInfo.publisher}"></span></li>
                            <li><span>ÌîåÎû´Ìèº</span><span th:text="${gameInfo.platform}"></span></li>
                            <li>
                              <span>Ïù¥Ïö©Ïó∞Î†πÎì±Í∏â</span>
                              <span
                                th:text="${gameInfo.ageRating}"
                                th:classappend="${gameInfo.ageRating == 'Ï≤≠ÏÜåÎÖÑ Ïù¥Ïö©Î∂àÍ∞Ä'} ? 'text-danger' : ''"
                              >
                              </span>
                            </li>

                            <li><span>ÏàúÏúÑ</span><span th:text="${gameInfo.ranking}"></span></li>
                          </ul>
                        </div>
                      </div>
                    </div>

                    <div class="anime__details__btn" th:if="${#authentication.name != 'anonymousUser'}">
                      <!-- ÌåîÎ°úÏö∞Î≤ÑÌäº ÎàÑÎ•¥Î©¥ Ïú†Ï†ÄÏÉÅÏÑ∏ÌéòÏù¥ÏßÄÏóê Ìï¥Îãπ Ïª®ÌÖêÏ∏† ÎùÑÏõåÏ§å -->
                      <button
                        class="follow-btn"
                        th:classappend="${isFollowed} ? ' follow' : ''"
                        th:data-mid="${gameInfo.gid}"
                      >
                        <i th:if="${isFollowed}" class="fa-solid fa-heart"></i>
                        <i th:if="${!isFollowed}" class="fa-regular fa-heart"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Ïä§ÌÅ¨Î¶∞ÏÉ∑ Ïù¥ÎØ∏ÏßÄ Î¶¨Ïä§Ìä∏ Ï∂îÍ∞Ä 0730 -->
            <div class="slider-container" id="sliderContainer">
              <div class="slider" id="slider">
                <img
                  th:each="url : ${screenshotUrls}"
                  th:src="${url}"
                  alt="Ïä§ÌÅ¨Î¶∞ÏÉ∑ Ïù¥ÎØ∏ÏßÄ"
                  style="border-radius: 10px"
                />
              </div>
            </div>

            <!-- Î™®Îã¨Ï∞Ω 0730 Ï∂îÍ∞Ä -->
            <div id="modal" class="modal" style="display: none">
              <span id="modalClose" class="modal-close">&times;</span>
              <button id="prevBtn" class="nav-btn prev-btn">&#10094;</button>
              <img id="modalImg" src="" alt="ÌôïÎåÄ Ïù¥ÎØ∏ÏßÄ" />
              <button id="nextBtn" class="nav-btn next-btn">&#10095;</button>
            </div>
            <div class="center-line"></div>
          </div>
        </section>

        <!-- ÎåìÍ∏Ä ÏòÅÏó≠ -->
        <div class="col-lg-6 mx-auto">
          <div class="anime__details__review">
            <div class="section-title">
              <h5 id="replyCnt" th:text="'ÎåìÍ∏Ä '+${replies.size} + Í∞ú"></h5>
            </div>
            <!-- Î≥ÑÏ†ê -->
            <div class="rating mb-3">
              <span th:text="' ÌèâÍ∑† '+${rating}+'Ï†ê'">ÌèâÍ∑† Î≥ÑÏ†ê</span>
            </div>
            <!-- ÎåìÍ∏Ä ÏãúÏûë -->
            <div th:each="reply : ${replies}">
              <div class="anime__review__item">
                <div class="re-reply-tag" th:if="${reply.ref != null}"></div>
                <div class="anime__review__item__pic">
                  <!-- Î°úÍ∑∏Ïù∏: ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏùÑ Í≤ΩÏö∞, Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄÏ∂úÎ†• -->

                  <img
                    th:src="${reply.thumbnailPath == null} ? '/images/sample.jpg' :'/images/view/' + ${reply.thumbnailPath}"
                    alt="ÌîÑÎ°úÌïÑ"
                    class="rounded-circle border border-primary shadow-sm"
                    style="width: 40px; height: 40px; object-fit: cover; background: #eee"
                  />
                </div>

                <div
                  class="anime__review__item__text reply"
                  th:data-rno="${reply.rno}"
                  th:data-replyer="${reply.replyer}"
                  th:data-replyerNickname="${reply.replyerNickname}"
                  th:data-text="${reply.text}"
                  th:data-mid="${reply.gid}"
                  th:data-mention="${reply.mention}"
                  th:data-rate="${reply.rate}"
                  th:data-ref="${reply.ref}"
                >
                  <span class="replyer text-light" th:text="${reply.replyerNickname}"></span>
                  <!-- <span class="text-secondary" th:if="${reply.mention}" th:text="' - '+${reply.mention}+ÏóêÍ≤å"></span> -->
                  <span class="text-secondary" th:text="' - ' +${reply.updatedDate}"> ÏûëÏÑ±Ïûê - 1 Hour ago</span>
                  <button
                    type="button"
                    class="delete-btn btn btn-secondary btn-sm"
                    th:data-rno="${reply.rno}"
                    th:if="${#authentication.name == reply.replyer}"
                  >
                    ‚úñ
                  </button>
                  <button
                    type="button"
                    class="update-btn btn btn-secondary btn-sm"
                    th:data-rno="${reply.rno}"
                    th:if="${#authentication.name == reply.replyer}"
                  >
                    ÏàòÏ†ï
                  </button>
                  <!-- <button
                    type="button"
                    class="mention-btn btn btn-secondary btn-sm"
                    th:data-rno="${reply.rno}"
                    th:if="${#authentication.name != 'anonymousUser'}"
                  >
                    ÎåìÍ∏Ä
                  </button> -->
                  <!-- Ìä∏Î¶¨Í±∞ Î≤ÑÌäº -->


                  <!-- Î¶¨Î∑∞Îäî Î≥ÑÏ†ê ÌëúÏãú -->
                  <span>
                    <i
                      th:if="${reply.ref == null}"
                      th:each="idx : ${#numbers.sequence(0, 4)}"
                      class="fa-star"
                      th:classappend="${reply.rate > idx ? 'fa':'fa-regular'}"
                    ></i>
                  </span>
                  <button
                    type="button"
                    class="delete-btn btn btn-sm text-white"
                    th:if="${#authentication.name == reply.replyer}"
                    th:data-rno="${reply.rno}"
                    aria-label="ÏÇ≠Ï†ú"
                    title="ÏÇ≠Ï†ú"
                  >
                    ‚úñ
                  </button>
                  <button
                    type="button"
                    class="update-btn btn btn-sm text-white"
                    th:if="${#authentication.name == reply.replyer}"
                    th:data-rno="${reply.rno}"
                    aria-label="ÏàòÏ†ïÌïòÍ∏∞"
                    title="ÏàòÏ†ïÌïòÍ∏∞"
                  >
                    <i class="fa-solid fa-pen-to-square"></i>
                  </button>
                  <button
                    type="button"
                    class="mention-btn btn btn-sm text-white"
                    th:if="${#authentication.name != 'anonymousUser'}"
                    th:data-rno="${reply.rno}"
                    aria-label="ÎåìÍ∏Ä Îã¨Í∏∞"
                    title="ÎåìÍ∏Ä Îã¨Í∏∞"
                  >
                    <i class="fa-solid fa-comment"></i>
                  </button> 
                  <button
                    class="report-btn btn btn-sm"
                    th:if="${#authentication.name != 'anonymousUser' 
                                  and reply.replyer != #authentication.name}"
                    th:data-rno="${reply.rno}"
                    th:data-replyer-nickname="${reply.replyerNickname}"
                    aria-label="Ïã†Í≥†"
                    title="Ïã†Í≥†"
                  >
                    üö®
                  </button>
                  
                  <pre><p th:text="${reply.text}">ÎåìÍ∏Ä ÌÖçÏä§Ìä∏</p></pre>
                </div>
              </div>
            </div>
            <!-- ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏ ÎÅù -->
          </div>

          <!-- ÎåìÍ∏Ä ÏûëÏÑ± Ìèº -->
          <div class="anime__details__form">
            <div class="section-title">
              <h5>ÎåìÍ∏Ä ÏûëÏÑ±</h5>
            </div>
            <span class="mention badge badge-secondary btn p-2"></span>
            <form id="replyForm" method="post" th:if="${#authentication.name != 'anonymousUser'}">
              <!-- Î≥ÑÏ†ê -->
              <div class="rating-form">
                <input type="hidden" name="rate" />
                <span class="rating" name="rate">
                  <i th:each="idx : ${#numbers.sequence(1, 5)}" class="fa-regular fa-star" th:data-value="${idx}"></i>
                </span>
              </div>
              <input type="hidden" name="gid" th:value="${gameInfo.gid}" />
              <input type="hidden" name="rno" />
              <input type="hidden" name="replyer" th:value="${#authentication.name}" />
              <input type="hidden" name="mention" />
              <input type="hidden" name="ref" />
              <textarea name="text" id="replytext" placeholder="Your Comment"></textarea>
              <div class="mb-4"><span id="currentCharCount">0</span> / <span id="maxChar">200</span>Í∏ÄÏûê</div>
              <button class="btn btn-insert modalBtn" type="submit" style="font-size: medium">Îì±Î°ù</button>
              <button class="btn btn-cancel" type="button" style="font-size: medium">Ï∑®ÏÜå</button>
            </form>
            <div th:if="${#authentication.name == 'anonymousUser'}">
              <a href="/user/login" class="btn site-btn" style="color: #eee">Î°úÍ∑∏Ïù∏</a>
            </div>
            <div class="p-4"></div>
          </div>
          <!-- ÎåìÍ∏Ä ÏûëÏÑ± Ìèº ÎÅù -->
        </div>
        <!-- gradient-bg Îã´Í∏∞ -->
      </div>
      <!-- Ïã†Í≥† Î™®Îã¨ -->
      <div id="reportModal" class="report-backdrop" aria-hidden="true">
        <div class="report-dialog" role="dialog" aria-modal="true" aria-labelledby="reportTitle">
          <div class="report-header">
            <h5 id="reportTitle">ÎåìÍ∏Ä Ïã†Í≥†</h5>
            <button type="button" class="report-close" aria-label="Îã´Í∏∞">√ó</button>
          </div>

          <div class="report-body">
            <div class="mb-2">
              <small>ÎåÄÏÉÅ ÎãâÎÑ§ÏûÑ</small>
              <div id="reportTarget" class="font-weight-bold"></div>
            </div>

            <label for="reportReason" class="mb-1">Ïã†Í≥† ÏÇ¨Ïú†</label>
            <select id="reportReason" name="reason" required>
              <option value="" selected disabled>ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
              <option value="INAPPROPRIATE_NICKNAME">Î∂ÄÏ†ÅÏ†àÌïú ÎãâÎÑ§ÏûÑ</option>
              <option value="SPOILER">Ïä§Ìè¨ÏùºÎü¨</option>
              <option value="PROFANITY">ÏöïÏÑ§</option>
              <option value="ADVERTISEMENT">Í¥ëÍ≥†/ÌôçÎ≥¥</option>
            </select>
          </div>

          <div class="report-footer">
            <button type="button" class="btn btn-secondary btn-cancel-report">Ï∑®ÏÜå</button>
            <button type="button" class="btn btn-primary btn-submit-report">Ïã†Í≥† Ï†úÏ∂ú</button>
          </div>
        </div>
      </div>

      <!-- Ï†ÑÏó≠ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
      <script>
        const id = "[[${gameInfo.gid}]]";
        const csrf = "[[${_csrf.token}]]";
      </script>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script th:src="@{/js/reply.js}"></script>
      <script th:src="@{/js/followbtn.js}"></script>
      <script th:src="@{/js/imgSlider.js}"></script>
      <script th:src="@{/js/imgModal.js}"></script>
      <script th:src="@{/js/report.js}"></script>
    </div>
  </body>
</html>
